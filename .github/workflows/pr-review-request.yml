name: PR Review Request

on:
  pull_request_review:
    types: [submitted, dismissed]
  pull_request:
    types: [review_requested, review_request_removed]

jobs:
  handle-review-requests:
    runs-on: ubuntu-latest
    steps:
      - name: Handle review request
        if: github.event_name == 'pull_request' && github.event.action == 'review_requested'
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo, number } = context.issue;
            const pr = context.payload.pull_request;
            const requestedReviewer = context.payload.requested_reviewer;
            
            // Notify the repo owner about review request
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: `üîç **Review Requested**
              
              @${owner}, a review has been requested for this pull request:
              
              **PR #${number}**: ${pr.title}
              **Requested Reviewer**: @${requestedReviewer.login}
              **Author**: @${pr.user.login}
              
              [View Pull Request](https://github.com/${owner}/${repo}/pull/${number})
              
              ---
              *This notification was automatically generated by GitHub Actions*`
            });
            
            console.log(`‚úÖ Notified @${owner} about review request for PR #${number}`);
            
      - name: Handle review submission
        if: github.event_name == 'pull_request_review' && github.event.action == 'submitted'
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo, number } = context.issue;
            const review = context.payload.review;
            const pr = context.payload.pull_request;
            
            const reviewState = review.state;
            const reviewer = review.user.login;
            const reviewBody = review.body || 'No comment provided';
            
            // Create a summary comment for the repo owner
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: `üìù **Review Submitted**
              
              @${owner}, a review has been submitted for this pull request:
              
              **PR #${number}**: ${pr.title}
              **Reviewer**: @${reviewer}
              **State**: ${reviewState.toUpperCase()}
              **Comment**: ${reviewBody.substring(0, 200)}${reviewBody.length > 200 ? '...' : ''}
              
              [View Review](https://github.com/${owner}/${repo}/pull/${number}#pullrequestreview-${review.id})
              
              ---
              *This notification was automatically generated by GitHub Actions*`
            });
            
            console.log(`‚úÖ Notified @${owner} about review submission for PR #${number}`);
            
      - name: Handle review dismissal
        if: github.event_name == 'pull_request_review' && github.event.action == 'dismissed'
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo, number } = context.issue;
            const review = context.payload.review;
            const pr = context.payload.pull_request;
            
            // Notify about dismissed review
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: `‚ùå **Review Dismissed**
              
              @${owner}, a review has been dismissed for this pull request:
              
              **PR #${number}**: ${pr.title}
              **Dismissed Review**: @${review.user.login}
              **Reason**: ${context.payload.dismissal_message || 'No reason provided'}
              
              [View Pull Request](https://github.com/${owner}/${repo}/pull/${number})
              
              ---
              *This notification was automatically generated by GitHub Actions*`
            });
            
            console.log(`‚úÖ Notified @${owner} about review dismissal for PR #${number}`); 